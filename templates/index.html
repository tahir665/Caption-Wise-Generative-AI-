<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CaptionWise</title>
        <meta name="author" content="Basim Bashir">
        <meta name="description" content="">

        <!-- Tailwind -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
        <style>
            @import url('https://fonts.googleapis.com/css?family=Karla:400,700&display=swap');

            .font-family-karla {
                font-family: karla;
            }
        </style>

        <!-- AlpineJS -->
        <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
        <!-- Font Awesome -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin="anonymous"></script>
    </head>
    <body class="bg-white font-family-karla">

        <!-- Top Bar Nav -->
        <nav class="w-full py-4 bg-blue-800 shadow">

        </nav>

        <!-- Text Header -->
        <header class="w-full container mx-auto">
            <div class="flex flex-col items-center py-12">
                <a class="font-bold text-gray-800 uppercase hover:text-gray-700 text-5xl" href="#">
                    Caption Wise
                </a>
                <p class="text-lg text-gray-600">
                    Empower your app experience with our state-of-the-art image-to-text Generative AI, effortlessly transforming visual moments into vivid and precise textual narratives.
                </p>
            </div>
        </header>

        <!-- Topic Nav -->
        <nav class="w-full py-4 border-t border-b bg-gray-100" x-data="{ open: false }">
            <div class="block sm:hidden">
                <a
                    href="#"
                    class="block md:hidden text-base font-bold uppercase text-center flex justify-center items-center"
                    @click="open = !open"
                >
                    Topics <i :class="open ? 'fa-chevron-down': 'fa-chevron-up'" class="fas ml-2"></i>
                </a>
            </div>
            <div :class="open ? 'block': 'hidden'" class="w-full flex-grow sm:flex sm:items-center sm:w-auto">

            </div>
        </nav>


        <div class="container mx-auto flex flex-wrap py-6">

            <!-- Post Section -->
            <section class="w-full md:w-2/3 flex flex-col items-center px-3">

                <article class="flex flex-col shadow my-4">
                    <div id="video-container" class="hover:opacity-75">
                        <iframe id="video-iframe" width="1000" height="500" frameborder="0" style="display: none" allowfullscreen></iframe>
                    </div>
                     
                    <a id="static-image" class="hover:opacity-75">
                        <img src="">
                    </a>
                     
                    <div class="bg-white flex flex-col justify-start p-6">
                        <div class="flex">
                            <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded" onclick="toggleCamera()">Start Camera</button>
                            <button class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded ml-auto" onclick="captureFrame()">Capture Frame</button>
                        </div>
                        <div class="mt-8">
                            <p href="#" class="text-sm pb-8">
                                By <a href="#" class="font-semibold hover:text-gray-800">Basim Bashir</a>, Published on January 4th, 2024
                            </p>
                        </div>
                        <h1 class="text-2xl font-bold pb-3">Caption:</h1>
                        <p id="processed-prompt" class="pb-3">captions will be shown here ... /</p>
                    </div>
                </article>

                <div class="w-full flex pt-6">

                </div>

                <div class="w-full flex flex-col text-center md:text-left md:flex-row shadow bg-white mt-10 mb-10 p-6">
                    <div class="w-full md:w-1/5 flex justify-center md:justify-start pb-4">
                        <img src="/static/profile_picture.jpg" alt="" class="rounded-full shadow h-32 w-32">
                    </div>
                    <div class="flex-1 flex flex-col justify-center md:justify-start">
                        <p class="font-semibold text-2xl">Basim Bashir</p>
                        <p class="pt-2">I am an eager Data Scientist driven to create transformative AI solutions by applying my expertise in Machine Learning, Computer Vision, and NLP. I am skilled at building market-ready products with the latest deep learning techniques to solve real-world problems.</p>
                        <div class="flex items-center justify-center md:justify-start text-2xl no-underline text-blue-800 pt-4">
                            <a class="" href="https://github.com/BasimBashir">
                                <i class="fab fa-github"></i>
                            </a>
                            <a class="pl-4" href="https://mail.google.com/mail/?view=cm&fs=1&to=basim.bashir0968@gmail.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                            <a class="pl-4" href="https://www.linkedin.com/in/basim-bashir-035403214?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app">
                                <i class="fab fa-linkedin"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="w-full flex flex-col text-center md:text-left md:flex-row shadow bg-white mt-10 mb-10 p-6">
                    <div class="w-full md:w-1/5 flex justify-center md:justify-start pb-4">
                        <img src="/static/tahirbhai.jpeg" alt="" class="rounded-full shadow h-32 w-32">
                    </div>
                    <div class="flex-1 flex flex-col justify-center md:justify-start">
                        <p class="font-semibold text-2xl">Muhammad Tahir</p>
                        <p class="pt-2">Passionate data science scholar skilled at statistical modeling and translating insights into solutions. Strong interest in analyzing data to drive business strategy and decision making.</p>
                        <div class="flex items-center justify-center md:justify-start text-2xl no-underline text-blue-800 pt-4">
                            <a class="" href="https://github.com/tahir665">
                                <i class="fab fa-github"></i>
                            </a>
                            <a class="pl-4" href="https://mail.google.com/mail/?view=cm&fs=1&to=m.tahee786@gmail.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                            <a class="pl-4" href="https://www.linkedin.com/in/muhammad-tahir-b1a571175/">
                                <i class="fab fa-linkedin"></i>
                            </a>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Sidebar Section -->
            <aside class="w-full md:w-1/3 flex flex-col items-center px-3">

                <div class="w-full bg-white shadow flex flex-col my-4 p-6">
                    <p class="text-xl font-semibold pb-5">Enter your Prompt</p>
                    <textarea id="promptTextArea" class="border border-gray-400 p-2 rounded shadow w-full" rows="4" placeholder="Describe this Image..."></textarea>
                    <button id="send-btn" class="w-full bg-blue-800 text-white font-bold text-sm uppercase rounded hover:bg-blue-700 flex items-center justify-center px-2 py-3 mt-4" onclick="sendPrompt()">
                        send
                    </button>
                </div>

                <div class="w-full bg-white shadow flex flex-col my-4 p-6">
                    <p class="text-xl font-semibold pb-5">Sample Images</p>
                    <div class="grid grid-cols-3 gap-3">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=1">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=2">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=3">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=4">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=5">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=6">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=7">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=8">
                        <img class="hover:opacity-75" src="https://source.unsplash.com/collection/1346951/150x150?sig=9">
                    </div>
                    <a href="#" class="w-full bg-blue-800 text-white font-bold text-sm uppercase rounded hover:bg-blue-700 flex items-center justify-center px-2 py-3 mt-6">
                        Select Image
                    </a>
                </div>

            </aside>

        </div>

        <footer class="w-full border-t bg-white pb-12">
            <div
                class="relative w-full flex items-center invisible md:visible md:pb-12"
                x-data="getCarouselData()"
            >
                <button
                    class="absolute bg-blue-800 hover:bg-blue-700 text-white text-2xl font-bold hover:shadow rounded-full w-16 h-16 ml-12"
                    x-on:click="decrement()">
                    &#8592;
                </button>
                <template x-for="image in images.slice(currentIndex, currentIndex + 6)" :key="images.indexOf(image)">
                    <img class="w-1/6 hover:opacity-75" :src="image">
                </template>
                <button
                    class="absolute right-0 bg-blue-800 hover:bg-blue-700 text-white text-2xl font-bold hover:shadow rounded-full w-16 h-16 mr-12"
                    x-on:click="increment()">
                    &#8594;
                </button>
            </div>
            <div class="w-full container mx-auto flex flex-col items-center">
                <div class="flex flex-col md:flex-row text-center md:text-left md:justify-between py-6">
                    <a href="#" class="uppercase px-3">About Me</a>
                    <a href="#" class="uppercase px-3">Privacy Policy</a>
                    <a href="#" class="uppercase px-3">Terms & Conditions</a>
                    <a href="#" class="uppercase px-3">Contact Me</a>
                </div>
                <div class="uppercase pb-6">&copy; CaptionWise.com</div>
            </div>
        </footer>

        <script>
            function getCarouselData() {
                return {
                    currentIndex: 0,
                    images: [
                        'https://source.unsplash.com/collection/1346951/800x800?sig=1',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=2',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=3',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=4',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=5',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=6',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=7',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=8',
                        'https://source.unsplash.com/collection/1346951/800x800?sig=9',
                    ],
                    increment() {
                        this.currentIndex = this.currentIndex === this.images.length - 6 ? 0 : this.currentIndex + 1;
                    },
                    decrement() {
                        this.currentIndex = this.currentIndex === this.images.length - 6 ? 0 : this.currentIndex - 1;
                    },
                }
            }

            let cameraActive = false;

            function toggleCamera() {
                cameraActive = !cameraActive;
                
                const staticImage = document.getElementById('static-image');
                // Update the iframe source and start the video
                const videoIframe = document.getElementById('video-iframe');
                
                if(cameraActive) {
                    staticImage.style.display = 'none';
                    videoIframe.style.display = 'block';
                    videoIframe.src = "{{ url_for('video_feed') }}";
                } else {
                    staticImage.style.display = 'block';
                    videoIframe.style.display = 'none'; 
                    videoIframe.srcObject = null; 
                }                      
            }

            // Global variable to store image  
            let staticImage = null;

            // Fetch image on load
            async function loadStaticImage() {
                console.log("Image loading")

                const response = await fetch('https://source.unsplash.com/collection/1346951/1000x500?sig=1');
                
                const imageBlob = await response.blob();

                // Cache image data 
                staticImage = new File([imageBlob], 'static.jpg', { type: 'image/jpeg' }); 
                // Get the URL of the loaded image
                const imageUrl = URL.createObjectURL(staticImage);

                // Update the src attribute of the image tag
                document.getElementById('static-image').firstElementChild.src = imageUrl;

            }

            loadStaticImage();
            
            function captureFrame() {
                // Check if the camera is active
                if (cameraActive) {
                    // Send a POST request to the server to capture the frame
                    fetch('/capture_frame', { method: 'POST' })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                // Reload the captured frame
                                document.getElementById('static-image').src = '/static/frames/captured_frame.jpg';
                            } else {
                                console.error('Failed to capture frame');
                            }
                        })
                        .catch(error => {
                            console.error('Error capturing frame:', error);
                        });
                } else {
                    const formData = new FormData();
                    formData.append('image', staticImage);

                    // Send POST request
                    fetch('/save_static_image', {
                    method: 'POST',
                    body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            console.log('Static image saved successfully');
                            updateStaticImage()
                        } else {
                            console.error('Failed to save static image');
                        }
                    })
                    .catch(error => {
                        console.error('Error saving static image:', error);
                    });
                }
            }

            // Function to update the static image source
            function updateStaticImage() {
                imagePath = "/static/frames/captured_frame.jpg"
                const staticImageElement = document.getElementById('static-image');
                staticImageElement.firstElementChild.src = imagePath;
            }

            function sendPrompt() {
                // Get the content of the textarea
                const promptTextArea = document.getElementById('promptTextArea');
                const promptText = promptTextArea.value.trim();

                // Set a default prompt if the textarea is empty
                const defaultPrompt = "Describe this Image";

                // Use fetch to send a POST request to the Flask server
                fetch('/process_prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: promptText || defaultPrompt }),
                })
                .then(response => response.json())
                .then(data => {
                    // Handle the server response if needed
                    console.log(data);
                    // Update the content of the processed-prompt element
                    const processedPromptElement = document.getElementById('processed-prompt');
                    processedPromptElement.textContent = data.processed_prompt;
                })
                .catch(error => {
                    console.error('Error sending prompt:', error);
                });
            }
        </script>

    </body>
</html>